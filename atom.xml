<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Bai Jiasong&#39;s blog</title>
  
  
  <link href="/blog/atom.xml" rel="self"/>
  
  <link href="https://dpatrickx.github.io/blog/"/>
  <updated>2021-01-11T17:54:10.587Z</updated>
  <id>https://dpatrickx.github.io/blog/</id>
  
  <author>
    <name>Bai Jiasong</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2020总结</title>
    <link href="https://dpatrickx.github.io/blog/2021/01/03/2020-summary/"/>
    <id>https://dpatrickx.github.io/blog/2021/01/03/2020-summary/</id>
    <published>2021-01-02T16:38:12.433Z</published>
    <updated>2021-01-11T17:54:10.587Z</updated>
    
    <content type="html"><![CDATA[<p>2020是多事的一年，也是自己人生中变动最大的一年。但在元旦假期即将结束的时候，翻看去年写的2019回顾，又感觉一年的时间转瞬即逝。</p><h3 id="疫情"><a href="#疫情" class="headerlink" title="疫情"></a>疫情</h3><p>2019年最后一天，和两个好友约了早上去故宫玩，这其实是自己在北京呆的七年里唯一一次去故宫。在坐出租去马三的路上，第一次看到微博上武汉不明肺炎的消息，但接下来的几天消息并没有进一步发酵，这件事似乎就像明星八卦一样，在引起有限的关注后很快被别的热点掩盖。<br>但这件事毕竟不一样，回到家后没几天，钟南山在央视连线中挑明了病毒是人传人的。于是，接下来就是长达半年的封禁。</p><p><img src="gugong.jpg" alt="故宫日光投影" width="600px"></p><p>除夕到元宵的两周时间，人心惶惶，每天起床后看到确诊数字比前一天又涨了很多，很快确诊人数就超过了SARS。<br>小区也很快封闭了起来，和贝有几次戴着口罩在小区下面散步，疫情封禁的氛围为见面增添了一份紧张感，将几个口罩带给贝，很开心。<br>忘了从哪一天开始，情况好转了起来，三月初第一次出门，和两个朋友一块绕小县城走了一整圈。</p><p><img src="xiaoqu.jpg" alt="小区旁建设中的高架桥" width="600px"></p><p>现在回想起来，似乎是和家做了一次长达半年的重逢和告别。<br>这几个月里，记忆中基本只有两件事情，白天和朋友们去新区打网球，深夜在电脑前写毕业论文，很深刻的回忆。<br>在回家之前，自己的毕业论文完全没有动笔，所以在家的几个月里自己其实是一直处于些许的焦虑之中。不过记忆似乎真的会隐藏掉负面的情绪，现在回想起来，这半年却是十分轻松舒适的。<br>在提交论文初稿后，和两个好友出去玩了几天，格外地开心。在家人和朋友身边总是很快乐，不过毕竟这无法成为生活中的常态。高三毕业那段时光，和朋友闲聊时说道和朋友呆在一个城市里，周末假期能一起玩是多好的生活。<br>现在看来，有的朋友在西安，有的在成都，未来大概还会有人去其他的地方，设想中的未来终究是无法成行。</p><p><img src="small-town.jpg" alt="家乡小城" width="600px"></p><p>半年时间里，很多次从小区出发，走到新区网球场，还有一次与贝一起在外面散步。一直认为自己其实是不怎么眷恋家乡的，但似乎过去这些年只有在家乡才能体会到宁静和放松。君子食无求饱，居无求安。不知道未来的自己找到足以维系一份宁静的地方时，会是在哪里，安身立命似乎离得很远。<br>然后经过几个月凑字数般低效率地论文写作后，终于等到了答辩这一天。<br>答辩一大早就开始，自己被排在第二个还是第三个，练习了好几遍的答辩拍下来再看时，却是吞吞吐吐，一字一蹦。到现在都没有完整地看一遍录像。</p><hr><h3 id="毕业"><a href="#毕业" class="headerlink" title="毕业"></a>毕业</h3><p>十多年的学生生涯结束了。<br>在2021年初的现在，回想这时候，却是像很久很久之前发生的事，好像比前半年在家的时光更早。</p><h4 id="杭州"><a href="#杭州" class="headerlink" title="杭州"></a>杭州</h4><p>毕业后，选择去杭州玩几天，顺便在上海租一下房子。<br>看房子的那天，一直在B站循环手塚国光到达天衣无缝极限的那集，过去这年因为开始打网球，正好就补了一下网球王子漫画，追完了网球王子动漫在过去一年连载的手塚和幸村的比赛。在某天早上，和博子一起到了杭州。</p><p><img src="west-lake.jpg" alt="西湖游船" width="600px"></p><p>住在西湖旁边的酒店，在杭州的几天里最远的行程距离酒店也不超过五公里，基本绕着西湖走了一整圈。<br>某天下午在湖边散步，就正好坐上了游船。想想自己在中学时候，其实总是有着明确的目标的，也很有执行力，而现在的自己似乎看不到什么目标了。就像这段时间，似乎什么东西也没想，也没做。</p><h4 id="别了清华"><a href="#别了清华" class="headerlink" title="别了清华"></a>别了清华</h4><p>从杭州回来后，就到了返校毕业的时候。不过就在启程前两天，北京发生了新发地疫情，启程那天在车上看着微博上新增人数的新闻，不知道到北京后还能不能顺利离开。而在到达学校的第二天，学校就中止了学生返校。<br>在学校的几天因为各种毕业手续忙个不停，骑着自行车在校园一直穿梭，东主楼、C楼、就业服务中心，每个地方几乎都去了五次以上，六级证书还没办好，直接申请了成绩证明。等到学位服发下来，早上五点多和豪去校园拍照，某天早上又去做了离京的核酸检测。<br>昨晚核酸检测第二天中午在吃饭的时候，查手机发现出了结果，于是马上订了次日的机票，下午就去东主楼领了双证，在端午节前办好了手续，最后竟然如期离京。在冷冷清清的机场和豪吃了午饭，简单的告别后去了不同的候机室。</p><p><img src="graduation.jpg" alt="去最多次的文图" width="600px"></p><p>太过匆忙的两周时间内，疲惫和焦虑似乎压过了毕业的离别心绪，现在回想起来，突然很想念在学校、在宿舍的日子。<br>感觉似乎和学校，和周围人缺少一个应有的告别。<br>不知道下次返回学校时，自己又处于怎样的境遇、怎样的心情中。</p><hr><h3 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h3><p><img src="plant-park.jpg" alt="植物园杉树" width="600px"></p><p>去年选择最终的工作时，最终做了连自己都意外的决定，不过现在看来，当时更应该坚持另一个选择。在这里半年多后，似乎又多了很多迷茫，又似乎自己在这里已经没有了前景。有时会很羡慕有单纯的热爱的人，无论在什么样的环境，这样的生活总是更值得过的。<br>所以，在2021年初的自己，还是得继续走下去，也许前面会有设想之外的生活。</p><p>今年终于和贝来到了一个城市，在前几个月的某个周末，和贝去了植物园散步，如果是自己一个人，可能不会在只有一天的周末选择去这里，两个人在一起总是能走得更远，而如果时间和空间是统一的，那两个人在一起，也总是能走得更久。</p>]]></content>
    
    <summary type="html">
    
      似乎是在说告别
    
    </summary>
    
      <category term="随笔" scheme="https://dpatrickx.github.io/blog/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="summary" scheme="https://dpatrickx.github.io/blog/tags/summary/"/>
    
  </entry>
  
  <entry>
    <title>2020阅读计划</title>
    <link href="https://dpatrickx.github.io/blog/2019/12/27/2020-read-plan/"/>
    <id>https://dpatrickx.github.io/blog/2019/12/27/2020-read-plan/</id>
    <published>2019-12-26T16:00:00.000Z</published>
    <updated>2020-04-04T20:33:17.716Z</updated>
    
    <content type="html"><![CDATA[<h4 id="计划"><a href="#计划" class="headerlink" title="计划"></a>计划</h4><p>很多想读的书买来却一直没认真看完，2020订下阅读计划，年末在此篇基础上进行总结 – 2019.12.17</p><h4 id="史哲"><a href="#史哲" class="headerlink" title="史哲"></a>史哲</h4><p>一、吕思勉《<a href="https://book.douban.com/subject/26600529/" target="_blank" rel="noopener">中国通史</a>》</p><p>吕先生通史分政治和文化两部分，文化方面平时几乎没有系统涉猎，所以期通过阅读这部分对制度、习俗、经济、民生等方面有大致了解。政治方面十分概要，但吕先生完全没有囿于旧见，有很多自己的见解，有偏颇，也有价值。新年希望通读并做笔记</p><p><img src="general-history.jpg" width="150px"></p><p>二、冯友兰《<a href="https://book.douban.com/subject/20501147/" target="_blank" rel="noopener">中国哲学简史</a>》</p><p>本科毕业典礼时的赠书，友兰先生的介绍简明扼要，目前读了儒家部分，希望明年读完</p><p><img src="philosophy.jpg" width="130px"></p><p>三、田余庆《<a href="https://book.douban.com/subject/10758290/" target="_blank" rel="noopener">东晋门阀政治</a>》</p><p>田先生最著名的作品，也是自己最为感兴趣的一段历史</p><p><img src="east-jin.jpg" width="130px"></p><p>四、孔飞力《<a href="https://book.douban.com/subject/10471333/" target="_blank" rel="noopener">叫魂</a>》</p><p>难得的佳作，在读第三章</p><p><img src="ghost.jpg" width="130px"></p><h4 id="小说"><a href="#小说" class="headerlink" title="小说"></a>小说</h4><p>一、沈从文《<a href="https://book.douban.com/subject/33411805/" target="_blank" rel="noopener">边城</a>》</p><p>想读已久的一本小说</p><p><img src="bian-cheng.jpg" width="180px"></p><p>二、加西亚-马尔克斯《<a href="https://book.douban.com/subject/6082808/" target="_blank" rel="noopener">百年孤独</a>》</p><p>马尔克斯是我最喜欢的作家之一，这本书自然在清单上</p><p><img src="100-years-of-solitude.jpg" width="130px"></p><p>三、马塞尔-普鲁斯特《<a href="https://book.douban.com/subject/10779650/" target="_blank" rel="noopener">追忆似水年华</a>》</p><p>意识流代表作，希望等待自己的不是辛苦而是惊喜和乐趣</p><p><img src="remembrance-of-things-past.jpg" width="130px"></p><p>四、George.R.R.Martin《<a href="https://book.douban.com/subject/10581248/" target="_blank" rel="noopener">A song of ice and fire</a>》</p><p>读英文版，所以进度很慢，希望读完第二本吧，同时阅读进度能加快一点</p><p><img src="a-song-of-ice-and-fire.jpg" width="150px"></p>]]></content>
    
    <summary type="html">
    
      史哲，小说
    
    </summary>
    
      <category term="随笔" scheme="https://dpatrickx.github.io/blog/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="summary" scheme="https://dpatrickx.github.io/blog/tags/summary/"/>
    
  </entry>
  
  <entry>
    <title>2019总结</title>
    <link href="https://dpatrickx.github.io/blog/2019/12/19/2019-summary/"/>
    <id>https://dpatrickx.github.io/blog/2019/12/19/2019-summary/</id>
    <published>2019-12-18T17:41:15.067Z</published>
    <updated>2020-04-04T20:38:59.949Z</updated>
    
    <content type="html"><![CDATA[<p>人在恍惚时，时间总是过得很快，2018年冬天投稿sigcomm及准备考试的匆忙好像还没过去，就到了今年末尾。<br>2019年变动颇多，所以重写久未更新的博客，以作记录。</p><p>年初在家很惬意，不过快到假期尾声时两件事的出现，提早结束了自己歇在家里的宁静。<br>一位心中很重要的女生突然联系，学校突如其来地宣布老师病重。<br>家里那几天却正好在下雪，只能耽搁一两天等雪停后出发。<br>到了临出发前一天，却在早晨得知噩耗，之后匆匆赶回北京，只赶上了老师的葬礼。</p><p>此时北京已经有了春天的迹象。临近毕业的自己也是迎来了秋招季，之前对于找工作一直不在意，此时却给自己很自然地添加了在上海找工作的目标。<br>很幸运的是正好有一个去苏州日常实习的机会，三月份便去了那边，在这边实习很愉快。公司不在市区，租的地方也在公司旁边，窗外是高铁站，周围就是一片片空地，晚上窗外只有公路两边的灯光。<br>实习期间主要在写C++，硕士期间几乎没用过，这次实习期间确实熟练度提高了很多，并且终于开始用C++ 11的一些语法，感觉自己之前真的是在技术毫无钻研。这次实习的同时也在投递暑期的实习，屡屡遭拒。一开始情绪会受到一些影响，不过慢慢就调整了心态。<br>不过这时候幸运再次到来，找学姐内推并通过微软的笔试后，焦急等待几周后实习面试安排在了一天早上，当天起来后连续完成三面，好在题都很简单，很顺利地结束了。正好这天晚上是复仇者联盟4首映，也是自己第一次追首映，下班后回到住的地方躺一会，然后去公司对面商场的影院，几个地方都是几百米的距离。事实上在苏州的几个月时间内自己几乎没有坐过公共交通，都是在公司旁边小范围内活动，宅到极点的自己没有觉得单调，反而是十分惬意，现在回想起来才觉得生活过于闭塞。<br>几天后的一个下午，上班时突然收到微软的实习录用邮件，很是惊喜。</p><p><img src="suzhou-railway-station.jpg" alt="苏州住处窗外" width="600px"></p><p>苏州实习结束后回到学校准备毕设开题相关事宜，不过一回到学校就回到低效拖延的状态里，作息完全混乱，真正要做的事情能拖就拖，在无尽重复的焦躁中惶惶不可终日。<br>在开题前一天做好PPT，开题前几个小时改好开题报告，完成开题的第二天就坐飞机到了上海，而到达上海后第二天就要去公司入职，十分匆忙的几天。来不及看房，此前一周在自如上只看照片就租了房子，幸好住处很方便没出现问题。</p><p>在微软三个月的实习很舒服，工作量很少，每天在公司大概只呆八小时多，其中很多时间还是在划水。<br>从刚到上海开始，就开始了字节跳动的提前批面试，自己对字节一直很有好感，很是看重，三面也都算顺利，很早就拿到了意向书，秋招过程中至少没有很心慌。虽然最后字节给出的待遇很一般，也没有选择，但对秋招过程还是帮助很大。<br>之后的秋招中自己又投递了大概十家左右的公司，一个自己基本能掌控的数量，没有和实习工作有很多的冲突。秋招结果也算顺利，自己肯定不属于最厉害的一批人，拿到的offer基本让自己满意。比较好的是秋招过程中自己都比较坦然，可能这也是这一年最多的一种情绪。</p><p><img src="IMG_0978.jpg" alt="上海音乐学院夜景" width="600px"></p><p>国庆后回到北京，确定工作时有些纠结，最后却是做了一个很意外的选择，只能希望未来不会过于后悔。<br>这年的三个月，自己又回到了糟糕状态的无尽循环中，找不到出路，找不到兴趣。一年前的现在，自己大致也是同样的状态。一年后，自己确定了要去上海工作，感情状态也发生了变化，生活的轨迹似乎确实是发生了很大的改变，但坐在宿舍里，又似乎什么都没变，自己还是那个糟糕的自己。</p><p>这一年，专业上自己应该是有很大进步的，但也还是赶不上自己心中的计划；没读几本书，反而是增长了自己的书单；没看几部电影，毕赣的《路边野餐》是难得的惊喜。<br>今年自己二十三岁，从五岁多进入小学开始到今年，不管明年毕业是否顺利，学生生涯总是到了结尾。自己的角色、目标也都会随之改变，希望自己有心气和能力来践行这些。<br>新的一年，希望能看得清自己，做可实现的计划并且坚持完成；能看得清工作，知道自己的能力范围和努力方向；能看得清时间，能好好利用自己的时间做些想做的事情而不是浪费。</p><p>北京的冬天总是在大风撕扯中变得苍白干燥无趣，但今年冬天却难得地下了两场雪，前几天趁下雪时下去拍照，附一张照片作为结尾。<br>明年再做总结时，自己已经不在这个呆了七年的园子里了，谈不上留恋，不过肯定会带走很多记忆，包括这场雪在内。</p><p><img src="IMG_1651.jpg" alt="雪中宿舍楼前" width="600px"></p><p><strong>博客撰写说明</strong></p><p>很早就设立了这个博客，不过随便放了几篇大作业报告后，几乎没有更新认真写的东西。<br>但快到人生新的阶段了，总该是要多反省自身，求知求进。所以，这个博客也要开始保持更新了。</p><p>博客在自己的github是开放的repository，自然是对公共开放的。所以不论是个人隐私，还是之后工作生活中的敏感信息，都不会出现在上面。<br>对于博客，之后可能会写自己工作中的感受，难免提及公司事务和同事，这里采取两种方法来防止信息泄露。</p><ol><li>省略 可以省去且不影响表达的敏感信息都会删除</li><li>脱敏 无法省略却不应暴露的信息，会进行模糊处理。处理方式不定，取决于当时具体的写作情况。一种容易想见的方法就是对人匿名、对事情抽象，不过这也只是最简易的一种方法，不排除会在保留主旨意思的前提下故意修改人物（如一人的事拆成多人，多人的事合成一人）和事情逻辑来模糊信息</li></ol><p>由此，在此博客出现的任何人事都不应当真，可以作小说家言，只需看作者意思即可。</p><p>写作范围不会做规定，会写技术总结、工作感悟、个人总结体会等。</p>]]></content>
    
    <summary type="html">
    
      算是变动颇多的一年啦
    
    </summary>
    
      <category term="随笔" scheme="https://dpatrickx.github.io/blog/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="summary" scheme="https://dpatrickx.github.io/blog/tags/summary/"/>
    
  </entry>
  
  <entry>
    <title>混沌理论</title>
    <link href="https://dpatrickx.github.io/blog/2019/01/31/chaos/"/>
    <id>https://dpatrickx.github.io/blog/2019/01/31/chaos/</id>
    <published>2019-01-31T01:00:00.000Z</published>
    <updated>2019-12-18T21:07:36.749Z</updated>
    
    <content type="html"><![CDATA[<p>假期上午，看了这部码了好久的纪录片，《The Secret Life of Chaos》。<br>第一次听chaos理论应该是在电影《侏罗纪公园》中，纪录片中也吐槽了这部电影对混沌理论的错误理解：“有一种普遍的误解，混沌只是大家熟悉的事实，一切都很复杂”。实际上混沌是“一些非常简单的、没有任何随机性的规则或公式，产生的结果却完全无法预测”。</p><p>纪录片中提到进化论，达尔文只是描述了生物在产生模式(性状)后，这种模式可以被编码在基因里，并且通过自然选择而遗传，却没有说这种模式是怎么产生的。<br>而图灵方程则可以从数学角度解释/预测这种模式形成（例如奶牛身上的斑块）。</p><p>这点给我印象很深，因为按中学所讲，模式的产生都是来自于基因的随机变异。<br>尽管这样的简单解释肯定与真实相去甚远，但之前我至少是相信性状产生的随机性的。而没有从模式形成这个角度去思考。</p><p>而认定”性状是以模式的形式产生的”后，枯叶蝶等生物形成逼真到吓人的拟态似乎也没那么困难，因为并不需要在浩如烟海的排列组合中拼凑出伪装色，而是从多种模式中选择某一种出来。</p><p>纪录片中关于有序和混沌的描述也很值得思考，“有规律和无状态是运行状态的两极”，蝴蝶效应让自然不可预知，但这样的不可预知又可以自发产生模式和结构。</p><p>越来越觉得无论是在学习还是一些别的阅读中，“观其大略”是很必要的，有了整体的概念再去思考具体的逻辑，丰富细节内容是更加有效的方法。</p><p>纪录片中提到了“复杂系统 (complex system)”概念，复杂系统并不是整体设计有多复杂，而是在简单的规则基础上，许多成分之间互相作用，使最终的结果无法预测。例如金融市场，就是很好的例子。</p>]]></content>
    
    <summary type="html">
    
      BBC-4《The Secret Life of Chaos》观后感
    
    </summary>
    
      <category term="笔记" scheme="https://dpatrickx.github.io/blog/categories/%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="note" scheme="https://dpatrickx.github.io/blog/tags/note/"/>
    
  </entry>
  
  <entry>
    <title>丁老师的一生</title>
    <link href="https://dpatrickx.github.io/blog/2018/01/07/ding/"/>
    <id>https://dpatrickx.github.io/blog/2018/01/07/ding/</id>
    <published>2018-01-06T17:00:00.000Z</published>
    <updated>2020-03-15T16:49:12.488Z</updated>
    
    <content type="html"><![CDATA[<p>其实之前想把技术博客和生活博客分开的，不过感觉自己更新频率几乎为0，还是先放在一块吧..</p><p>这学期刚开学，和几个同学xjb写的东西，大概就是讲一个人物的故事，五年一个节点，每人写一段。</p><p>想想自己高中时还会写一些奇怪的东西放在QQ空间，现在就是一条咸鱼..</p><p>写的时候我一直坚持”平平淡淡才是真”，但其他几个人总是XJB给设定，到我再强行掰回来..于是整体看就有人格分裂的感觉..</p><p>暑假回去翻到了自己高中时写的纸条，深刻感觉自己现在写作水平不如高一..虽然那时很矫情..</p><hr><p><strong>《丁老师的一生》</strong></p><h4 id="五岁"><a href="#五岁" class="headerlink" title="五岁"></a>五岁</h4><p>是个男孩，提前一年上了小学，对奥数很感兴趣。</p><h4 id="十岁"><a href="#十岁" class="headerlink" title="十岁"></a>十岁</h4><p>5年级了，并没有表现出突出的数学天赋，虽然整体成绩还可以。爸妈吵架，离婚了。跟妈过日子，还好母亲在大学当老师，生活还可以，在一个二线城市，emmmmm，杭州，过着中产阶级生活。比较喜欢同桌小女生。上了个美术班。</p><h4 id="十五岁"><a href="#十五岁" class="headerlink" title="十五岁"></a>十五岁</h4><p>初中升高中 成绩一般就考了个一般学校的一般班级 毕业的时候鼓起勇气对喜欢的姑娘表白 用学来的绘画画了个画册 然后被拒绝 很难受 一个人坐火车去北京找父亲  父亲带他出入各种娱乐场所  结果某天趁他爸不注意被下药性侵 因为相关法律不完善犯人没有得到惩处 最后被父亲送回杭州。</p><h4 id="二十岁"><a href="#二十岁" class="headerlink" title="二十岁"></a>二十岁</h4><p>20岁，五年前被性侵对他的心理造成了巨大的影响，由于在此之前对性的认知仅限于异性，导致对自己的性别产生怀疑，一个女孩的人格在体内悄然诞生成，回到学校后随着时间推移性格更加孤僻，难以和人交往，没有朋友，高考成绩很差，在一所大专上课，今年刚大二，没谈过恋爱，最近感觉自己上铺的室友人很好，喜欢和他说话。</p><h4 id="二十五岁"><a href="#二十五岁" class="headerlink" title="二十五岁"></a>二十五岁</h4><p>25岁，他将往日的阴影深深藏起来，不对任何人讲，这样似乎生活好过了一些。对周围环境的不满让他选择了考研，在大专里这个选择就像他本人一样，格格不入。幸好上铺的室友是他的战友，大专几年的生活里室友是他可以看做“朋友”的人。他竟然真的考到了一所普通一本的研究生。</p><p>今年，他到了研究生最后一年。绘画功底还在的他入学后加入了校会宣传部，这天看完电影，部里的同乡学妹刚向他告白，懵逼间，他选择了拒绝。回到宿舍，他爬上床，这些年，他都是挂着床帘，抱着熊布偶才能睡觉。学妹的告白让他很心烦，没有去掩上帘子。室友经过床下，“哇你好少女啊”，一条拍了照的朋友圈随之发出。室友嬉笑间，他翻身下床夺过手机扔出去，摔门走出宿舍。</p><p>毕业季到了，妈妈从杭州来到北京，七月的阳光总是很刺眼。坐在饭店里，妈妈看着已经长大的孩子，又想起他当年遍体鳞伤回到家的样子。她一直都不擅长和孩子交流，但现在她想劝他回去工作，她的人脉能帮他安排一份不错的工作。话刚说出口，“别对我露出怜悯的眼神，我不需要！”他转身离去。</p><p>学妹后来又一次表白，这次他却接受了，可能他自己也说不出为什么。和妈妈闹出不愉快后，学妹找到他，她也想劝他回去工作，这样她毕业后可以回去考公务员，两人有个安稳生活，他摇摇头。“为什么，是不是你当初…”，他不想听了，推开学妹，“留我一个在我破败的人生里吧。”</p><p>他找到学校比较熟的社团老师。</p><p>“有能拿到本地户口的工作吗？”</p><p>“嗯一所初中最近招个美术社负责老师，工资低点。”</p><p>“好。”</p><p>“学校很差，学生不好管，你好好考虑下。”</p><p>这是所郊区的初中，配合政策要搞个美术社出来拿补助，所谓美术社也就是一间水泥教室，十来个不想上课来玩的学生。他在门口停下，顿了顿，走进去，“大家好，我是新来的老师，姓丁。”</p><h4 id="三十岁"><a href="#三十岁" class="headerlink" title="三十岁"></a>三十岁</h4><p>来到美术社的他全身心的投入了这份工作。他疯狂的自学绘画，弥补自己因为欠缺专业学习而略显薄弱的功底。他的画越画越好，他有点沉默，但学生们似乎很喜欢他，慢慢的，参加这个美术社的学生越来越多。跟他学习的有些同学拿到了中考特长加分，学校也给他换了间大教室。</p><p>他发现自己似乎重新找回了年幼时对于数学的敏感。不过不是在真正的数学中，而是在绘画中。他在绘画中找到了一种独特的感觉，色彩的对比，线条的比例，物品的透视。他痴迷于这一切。每天除了教学生，他就是在学校分配的教职工宿舍里画画。宿舍里堆满了各种颜料和画具。</p><p>有一个新加入美术社的女孩子似乎对这个老师很好奇，整天和老师套近乎。</p><p>女孩很可爱，但是他却莫名有点恐惧，总是躲着女孩。</p><p>但是女孩是执着的，这一天下了课。女孩等所有学生走完，跑到老师面前说，老师，能单独教我画画吗，我马上要参加特长考试了。</p><p>老师有点不敢看她的眼睛，沉默了一会儿，说，没事，你好好跟着大家一块儿学，通过没问题的。</p><p>然后转身有点狼狈的离开了。</p><p>回到宿舍，他下意识的支起了画板，像每天一样随便画了起来。</p><p>“为什么不答应她”</p><p>“答应什么”</p><p>“带她回来，来家里，慢慢教她”</p><p>“没有必要，她可以通过考试”</p><p>“你不想带她回来吗”</p><p>“她只是个孩子”</p><p>“所以很可爱不是吗”</p><p>“别说了”</p><p>“你喜欢她”</p><p>“别说了”</p><p>“你知道的”</p><p>“别说了！”</p><p>老师大喊一声站了起来，滑板也被打落在地。耳边的声音消失了，老师看着掉在地上的画板，手中的画笔慢慢滑落——画纸上画着那个小女孩，很可爱。</p><p>第二天上完课，学生陆续离开。老师喊了一声小女孩，小女孩噘着嘴走了过来。</p><p>“干嘛？”小女孩在生老师昨天逃跑的气。</p><p>“跟我来。”</p><p>小女孩挥了挥小拳头，低呼了一声“耶”。背上书包跟上了老师，去了他的宿舍。</p><p>“哇！”小女孩被老师堆在宿舍里的各种画惊呆了。凌乱的宿舍一点也没让她感到困扰，她在这一堆画里左看看右看看，不是发出赞叹。</p><p>女孩在老师天才般的画作中陶醉了好一会儿，突然觉得不对劲，老师呢？</p><p>她一回头，老师不见了，好像好一会儿没动静了。</p><p>“老师？”</p><p>女孩站起来喊了一声，突然有点害怕。</p><p>“老师？你在哪儿？”</p><p>咔嚓。厨房传来了一点动静。</p><p>女孩小心翼翼走向厨房。</p><p>“啊！”女孩刚走到厨房门口，一个身影突然冒了出来。</p><p>“瞎喊什么呢。”老师拿了一个盘子，里面放了两个三明治，有点无奈地说。</p><p>女孩有点不好意思的吐了吐舌头，“谁让老师你不说话呢。”</p><p>老师和女孩吃了三明治。老师开始认真的教女孩画画。初中的特长考试很简单，老师明白其中套路，只要线条干净，比例协调，通过很简单。女孩学的很快。</p><p>“唉，老师，你袖子上怎么回事。这是血吗。”</p><p>“哦，没事，只是不小心粘上了颜料而已。”老师笑了笑，脸色有些苍白。</p><p>……</p><p>“老师再见。”女孩带着欢快的笑容，向老师挥了挥手。</p><p>“嗯，再见。”</p><p>女孩走了。老师关上门，慢慢坐在了地上。挽起左边的袖子，老师的左臂上一道长长的血痕，被保鲜膜胡乱裹着。（细节不表，自行脑补，大概是和另一个人格产生了冲突。）</p><p>第二天，美术社上课，老师没来。一位胖胖的女老师来对大家说，老师请了病假。</p><p>女孩皱起了好看的眉毛。</p><p>下了课，女孩去敲老师宿舍的门，敲了好久，却没人开门。</p><p>过了周末，女孩才知道，丁老师已经辞职了。</p><p>老师，你去哪儿了。</p><p>…………</p><p>老师离开了学校，他回家找到了母亲。</p><p>“妈，给我一笔钱好吗。我想离开这里。”</p><p>妈妈卖掉了老房子，他拿上这笔钱去了欧洲旅行。</p><p>他去了很多地方。最后到了巴黎。</p><p>他用最后的钱买了卢浮宫的门票。</p><p>他走到了那副画前。</p><p>《蒙娜丽莎》。</p><p>色彩的对比，线条的比例，物品的透视。</p><p>他笑了起来。</p><p>“果然。他也是。”</p><p>“你早就知道了。”</p><p>“没错，我早就知道了。”</p><p>“他把自己画的很美。”</p><p>“很美。”</p><p>……</p><p>巴黎突然多了一个街头画家。</p><p>他什么都画，什么东西在他笔下都充满了别样的意趣。</p><p>他的画被人发到网络上，很快引起了很多人的关注。就算是主流绘画界的大师也给了他的画很高的评价。</p><p>一位法国当代著名大师在网络上看到他的画以后专门来到了街头来见他。</p><p>“你真是个天才。”大师对他认真的说。</p><p>他笑了笑。在心里说。</p><p>“他说你是天才。”</p><p>“我们是。”</p><p>30岁，在街头，他的画已经卖出了不菲的价钱。</p><p>可是他总是想起那个女孩的眼睛。</p><h4 id="三十五岁"><a href="#三十五岁" class="headerlink" title="三十五岁"></a>三十五岁</h4><p>“Bonjour，Monsieur！”</p><p>“哎，哎…Bonjour…”</p><p>他有些不自然地回应着和他问好的路人。来到巴黎好几年了，但他的法语还是停留在入门级日常用语，除了购买生活用品和出售画作，他几乎不和别人交流。</p><p>但成名带来的，必然有越来越多的关注。他每天还是会上街作画，但认出他，和他打招呼的人越来越多，渐渐地，评论家开始批评起他的画，说他一开始画里的某些东西不见了，说他的画变了，说他变了。</p><p>“不，你这里不该这样画。”</p><p>塞纳河边的长椅上，他又一如既往地在独自作画。</p><p>“为什么？我觉得没问题。”</p><p>“这样会让画布的左半边显得太空旷。”</p><p>“空旷？空旷会让对比更加强烈。”</p><p>“可是也让画作更加不协调了。”</p><p>“闭嘴！还轮不到你来教我绘画！”</p><p>“哈！你忘了自己以前的画都是怎么做出来的吗？没有我，哪儿有你今天的成就！”</p><p>“成就？得了吧！”</p><p>“看看你的周围！看看那些对你满脸爱慕的姑娘，看看那些挤进我们家们只为买一幅画的富人们，看看那些对我们点头哈腰的画廊商人们！这一切不是我帮你得来的吗？这一切不正是你当初学绘画的目的吗？！”</p><p>“够了！”</p><p>他用力捏着手中的画笔，是自己不在行人络绎的河边吼出来。但是这样的对话并不是第一次了，他知道也不会是最后一次。他叹了口气，收拾好东西向家里走去。</p><p>就一个著名画家来说，他的家显得太小太偏僻。但每天都有很多人找上门来，或是求购一幅画作，或是商谈合作。</p><p>他没有理睬，径直走上台阶。</p><p>“丁老师？”</p><p>“没有画卖。”他头也不回地说道。</p><p>“您误会了，我是中国XX画家协会的，想起您去国内做一次讲座。”</p><p>“不去。”他打开门走了进去。</p><p>“国内的孩子都很崇拜您，我们也联系到了几位您以前的学生，想让您传授一点人生经验给他们。”</p><p>他关门的手停了下来：“什么时候？”</p><p>对方赶忙上前一步：“您方便就行，最好两周之内出发。”说着掏出一张名片递过来。</p><p>他接过名片，又看了那人一眼，关上了门。</p><p>“真的要去？”</p><p>“恩。”</p><p>“还回来吗？”</p><p>漆黑的房间里窗帘拉得死死的，他坐在沙发上，摩挲着手指。</p><p>“…….不知道”</p><p>“你真的想放弃我们好不容易得来的一切？”</p><p>“……”</p><p>“我们努力了这么多年，不就为了现在的地位和身份？为了变得强大，变得没有人可以伤害到我们。没有这些，我们还剩下什么？微不足道的名头和你越来越烂的画技吗……”</p><p>“我的画技？你真的在乎过我的画技吗？这么多年你在乎过我想要什么吗？”</p><p>“你？”他听见自己发出轻蔑的笑声，“你想要的东西能让我们走到今天吗？那些可笑的追求和幻想？”</p><p>“别忘了，一开始让我们的画引人注目的，就是你口中那些可笑的东西。”</p><p>“我们……”</p><p>“我会回去。”他站了起来，缓缓向窗边走去，“我会回去，因为我已经不属于这里，因为我想要的，从来都不在这里。”</p><p>他拉开窗帘，巴黎五月的阳光照了进来，照亮房间中画满墙壁的眼睛。</p><h4 id="四十岁"><a href="#四十岁" class="headerlink" title="四十岁"></a>四十岁</h4><p>他终于回到了这座城市。</p><p>很快到了讲座那天，他换上新买的正装，打理了乱糟糟的胡须，来到了现场，却没能看到那个常在梦中出现的身影。</p><p>“也是，怎么可能这么巧呢”他笑着对自己说。</p><p>……..</p><p>  “老师！”</p><p>他猛然转过头去，看到了面前女孩眸子里的光。</p><p>“好久不见了啊老师！你变了呢！变得有男人味了·”</p><p>“对不起啊老师，本来早就应该到了的，路上堵车了，堵了好久好久，我没办法只好扫了辆自行车自己骑车过来的，累死我啦。”</p><p>  “老师你真是的，当时怎么不打个招呼就辞职啊，害的人家怎么都找不到你！”</p><p>女孩的额头在灯光下微微发光,头发迎着微风轻轻摆动，脸蛋也因为运动显得通红。</p><p>他看着女孩笑盈盈的脸，轻声对自己说：“我回来了。”</p><p> ……</p><p>在和女孩的谈话中他得知，原来女孩一直没有放弃对画画的热爱，她努力学习，最终以优异的成绩考入了一所顶尖的美术学校，因为画中藏着的一抹灵气，在圈子里已经小有名气，还举办过两场自己的个人画展，这次听说了他的消息，专程赶来见他。</p><p>他和女孩一起去吃饭，他从来没有喝过酒，可是今天他想尝尝，他看着女孩的眼睛，他觉得这双眼睛里有整个世界，他醉了。</p><p>吃完饭到了深夜，他和女孩互相搀扶着，漫步在街头。</p><p>“老师你好逊哦，才喝这么点就走不动了，你看我！我还能喝！我还能用鼻子喝！”</p><p>“真是傻姑娘，哪有人能用鼻子喝酒的”</p><p>“老师你不信？ 你看着！ 阿嚏！ 咳咳咳！  老师啊，这个酒怕是过期了，好呛人！”</p><p>他笑得像个孩子。</p><p>…….</p><p>“小妹妹你喝多了啊，真可爱，咱一块再去喝点呗”</p><p>“就是，笑得这么开心，来陪陪哥几个。大家一起乐呵乐呵嘛！”</p><p>“别怕，小妹妹，大家都是文明人，我们不会伤害你的。”</p><p>他看着堵住去路的几个男人，大脑一片空白。</p><p>“是你！  不！不是你！  不！是你！ 是你！！”</p><p>他害怕。</p><p>他转过身，丢下女孩，夺路而逃。</p><p>他哭喊着穿过马路，用尽全身力气奔跑，一刻不敢停。</p><p>他听到声响，转过头，眼前是一片光明。</p><p>……..</p><p>三天后他在医院醒来，看到新闻上被害人的笑颜，他发现自己的眼睛已经看不到色彩。</p><p>他买了去巴黎的机票，狼狈地回到了这个不属于他的城市。</p><p>三十五岁的他，卢浮宫前流浪。</p><h4 id="四十五岁"><a href="#四十五岁" class="headerlink" title="四十五岁"></a>四十五岁</h4><p>春季的清晨里还透着几分清冷，他推开有些沉重的大门，几分刺骨的寒意从金属上传来。四十五岁，他搬进了新建好的郊区别墅。围墙里庭院空空荡荡，围墙外是覆着斑驳白雪的空地，这里的房子和主人一样沉默。经过走廊上了台阶，他脱去大衣挂在一旁。现在的他需要呆在一个和外界隔离的空间，来求得一丝舒适。</p><p>几年来，他开始在清晨时外出散步，于是还没醒来的世界总会配上一个孤独的身影，稀薄的晨光不足以渲染出所有的色彩，但他并不在意，五年前那场车祸早已将色彩从他身上抽离。曾经那么熟悉，那么亲近，美术教室、塞纳河畔，无论生活境遇如何，色彩似乎都是他最熟悉的朋友，是他唯一能掌握的东西，他是那么全身心的沉浸在其中，以至于这突然的抽离感比撞断的肋骨还要刺痛。</p><p>自那以后，他开始变得沉默，他没有再拿起过画笔，脑海中的声音也渐渐隐去。在巴黎，他失神落魄地流浪了三个月，然后似乎想通了什么，他用身上所有的钱买了回国的机票。国内还算有几个朋友，他们一起办了美术评论杂志，“大众需要一双眼睛，特别是在人均GDP快两万刀的中国”。国内正是”建立民族文化自信心“的时候，风口上，他们的杂志很快赚得盆满钵满。然后，他离开了，外面太吵了。</p><p>这天，他开车到市区来采购生活用品。商场里灰色的人群拥塞在电梯上。他突然很怀念他的初恋，他已经记不清她的样子，却记得她表白时穿着红色的外衣，十分显眼的红色。突然，窗外一抹红色掠过，好像一道闪电划过他的脑海，他扔下手里的东西追了出去。</p><p>她是在市区流浪的小孩，出生在城市最脏乱的贫民区，从未谋面的父母是城市的非法居民，一个嗜酒，一个吸毒，她出生后不久他们就先后失踪。她到现在也还没有户籍，没有身份。但她不懂，也不在意。这天，她从贫民窟的捐赠品堆里拿到一件新的外衣，高兴的跑向广场，想向她的鸽子朋友们展示。不过她没有成行，一个胡子拉碴的大叔蹲在她面前，他的眼睛里透出一种奇怪的渴望，让她不由停了下来，“叔叔，你怎么了？”。</p><p>他带小女孩回到了住的地方，他始终不习惯把这里称作“家”。收拾干净的小女孩换上他刚买的新衣服。</p><p>“哇，叔叔你这么喜欢红色呀。”</p><p>他却已经听不见她的声音。</p><p>“色彩！色彩！！色彩！！！”</p><p>眼前的女孩在红色的映衬下笑靥如花。他伸手用力按在女孩的肩膀上。</p><p>“叔叔！”，被弄疼的女孩不满的抱怨。</p><p>不顾女孩的挣扎，他将女孩单手抱起，走进楼上卧室。</p><p>当好花被折，是该惋惜美好不再，还是该沉醉于在摧毁时刻迸发而出的惊艳？</p><p>眼前的红色挣扎着、跳动着。</p><p>那是生命力！</p><p>那是色彩！</p><p>那是他从未领略过的美好！</p><p>他原谅了当年那个男人，他懂得了当年那个男人！</p><p>原来感情从来都是一种掠夺！</p><p>眼前的红色逐渐停止跳动，慢慢蔓延开来，染红了床，染红了他的双手。</p><p>色彩啊！！！</p><p>春天总是短暂的，严酷的夏日随之而来。</p><p>一个小男孩打开冰箱，“咦？叔叔你家好多生肉片啊，饮料呢？”</p><p>他过来关上冰箱门，“走错地方了，饮料在那边”。</p><p>小孩欢笑着跑了过去。</p><p>他的脸上也露出了久违的微笑。</p><p>……</p><p>美好也是短暂的，昨天下午，有警察来做调查，看了好几个房间。</p><p>他明白国内待不住了。</p><p>他将房子出售，在警方抓捕之前，他登上了飞机。看着云彩下的城市，他知道此生不会再踏上这片土地。</p><p>不过这并不重要，因为，他要色彩。</p><h4 id="结局"><a href="#结局" class="headerlink" title="结局"></a>结局</h4><p>飞机上的他将目光从窗外收回。拉下遮光板，他缓缓的靠在椅子上，进入了梦乡。突然一阵剧烈的震动将他从梦中惊醒……</p><p>“一架飞往美国的波音777遭遇雷暴，引擎爆炸后坠入太平洋，飞机上共有312名乘客……”</p><hr><ul><li>一、五、九：我</li><li>二、六、十：萨雷</li><li>三、七：阿邵</li><li>四、八：頔</li></ul>]]></content>
    
    <summary type="html">
    
      丁老师的奇怪的一生
    
    </summary>
    
      <category term="随笔" scheme="https://dpatrickx.github.io/blog/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
  </entry>
  
  <entry>
    <title>足球机器人 - 球场检测</title>
    <link href="https://dpatrickx.github.io/blog/2016/07/31/soccerRobot/"/>
    <id>https://dpatrickx.github.io/blog/2016/07/31/soccerRobot/</id>
    <published>2016-07-31T15:00:00.000Z</published>
    <updated>2019-12-18T21:07:25.524Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-概况"><a href="#1-概况" class="headerlink" title="1. 概况"></a>1. 概况</h3><p>在本部分我主要负责检测球场和确定机器人位置的工作.<br>具体可以分为:</p><ol><li>根据标注出白线的kinect视角图(424*512)，进行坐标映射、直线拟合来确定视野中属于的各条线;</li><li>在1的基础上确定机器人的坐标及朝向.</li></ol><h3 id="2-坐标系说明"><a href="#2-坐标系说明" class="headerlink" title="2. 坐标系说明"></a>2. 坐标系说明</h3><ul><li>图片坐标系(rc): 左上角为(0, 0), r轴向右, c轴向下;</li><li>kinect坐标系(xyz): 即kinect坐标系, 以kinect镜头为原点, x轴向左, z轴为镜头法线方向, y轴与z轴垂直, 指向上;pict 1</li></ul><p><img src="http://i.imgur.com/mkdYPfM.png" alt=""></p><ul><li>机器人坐标系(uv): 以左上角为原点, u轴向右, v轴向下的机器人视角平面图. 机器人为(423, 255)点;</li><li>世界坐标系(XY): 在球场中的坐标系, 面向对方半场, 以左上角为原点, u轴沿底线向右, v轴沿边线向后.</li></ul><h3 id="3-坐标变换方法"><a href="#3-坐标变换方法" class="headerlink" title="3. 坐标变换方法"></a>3. 坐标变换方法</h3><p>通过之前同学的视觉识别工作, 已经可以标记出kinect深度图中属于白线的部分, 即知道白线的图片坐标.</p><p>在此基础上调用libfreenect2中getPointXYZ()函数, 可以获知kinect深度图视野中任一点在kinect坐标系下的坐标, 即知道图片的kinect坐标.</p><p>接下来要做的工作就是将kinect坐标转换为机器人坐标, 在实验中我们是将kinect固定在机器人最上方, 用俯瞰的方式来观察球场, 因此kinect和水平面之间有一个固定夹角. 如下图:</p><p><img src="http://i.imgur.com/qfwokQG.png" alt=""></p><p>通过图中所示, 可知, kinect坐标系下(x, y, z)映射到机器人坐标(u, v)的映射关系为:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u = 256 +　x</span><br><span class="line">v = 424 - (z*cos(theta) + ｄ)</span><br></pre></td></tr></table></figure></p><p>其中ｄ是为了将坐标修正到机器人中心所加常数, theta是kinect与水平面所成夹角, 该余弦值可以经过预先测定获取．</p><p>因为kinect所得视野左右颠倒, 因此在这里对u坐标取反.</p><p><img src="http://i.imgur.com/mpvEm3Y.png" alt=""></p><p>不难发现, 该映射对球场完全成立的前提是球场各点高度相等, 因此当球场上存在褶皱时, 该映射对褶皱部分所得的v值会偏小, 因此褶皱部分在所得平面图中影响会被放大, 如下图, 底线上的褶皱导致所得平面图很不规整.</p><p><img src="http://i.imgur.com/pafT2ro.png" alt=""></p><h3 id="4-球场检测"><a href="#4-球场检测" class="headerlink" title="4. 球场检测"></a>4. 球场检测</h3><p>接下来所要做的工作就是用直线来拟合球场的边线\禁区线, 这部分也是整个部分耗时最多, 代码量最多的部分. 究其原因就是3中所得平面图中各条边线并不规整. 因此用了很多 取平均/求拟合 的方法来尝试得到较好的匹配结果.</p><h4 id="4-1-直线拟合"><a href="#4-1-直线拟合" class="headerlink" title="4.1 直线拟合"></a>4.1 直线拟合</h4><p>往届中有使用直线拟合来完成本工作的例子, 因此最开始选取此方法来对球场进行拟合, 尝试用拟合+筛选的结果来作为球场匹配结果, 具体思路如下:</p><ol><li>使用Canny算子完成边检测, 即理想情况下只保留各条白线的边框, 实际操作中可以在本步之前加一些模糊操作;</li></ol><p><img src="http://i.imgur.com/xckYzCF.png" alt=""></p><ol><li>使用霍夫变换来检测直线, 因为1中只保留了白线边框, 因此这里可以对拟合结果进行一定的平移, 以达到拟合白线中心的目的;</li><li>对所得直线进行筛选, 可以采用判断 经过白点总数/连续经过白点数目的方式;</li><li>如果两条直线距离在一定范围内, 进行合并, 保留经过白点数量多的直线, 反复执行直到没有可以合并的直线为止;</li><li>所得即为最终拟合结果.</li></ol><p>因为存在之前所提的边线不规整的原因, 所以本步得到的结果很糟糕, 几乎不能用来进行匹配和定位, 如下图:</p><p><img src="http://i.imgur.com/897UO9G.png" alt=""></p><h4 id="4-2-固定模式匹配"><a href="#4-2-固定模式匹配" class="headerlink" title="4.2 固定模式匹配"></a>4.2 固定模式匹配</h4><p>在4.1基础上, 最后采用了 “先确定球场大致位置, 再用规整的球场来拟合角度” 的思路.</p><h5 id="4-2-1-确定角球点"><a href="#4-2-1-确定角球点" class="headerlink" title="4.2.1 确定角球点"></a>4.2.1 确定角球点</h5><p>因为角球区特征最为明显, 而且容易确定原点位置, 因此我们尝试先利用4.1中的算法大致确定球场是否是角球区, 如果是的话, 再找到角球点位置, 再在角球点周围, 用标准的球场线来”拟合”白点, 拟合白点最多的角度就是配准后的结果.</p><p>按这个思路, 接下来的重点就是如何判断角球区以及如何准确地找到角球点位置.</p><p>首先为了排除干扰, 先反复使用erode和dialite函数来获取白线的skeleton, 再去除图中的孤立点, 结果如下图:</p><p><img src="http://i.imgur.com/2aQrrYj.png" alt=""></p><ul><li><p>判断角球区:</p><ol><li>角球区一般拟合结果会有4条距离较近的直线, 因此可以用直线距离作为判断准则;</li><li>角球区另一个特点就是有两条边线, 边线的确定可以遍历所有白点, 如果大多数白点都在直线的某一侧, 就可以将该条直线看做边线.</li></ol></li><li><p>获取角球点:</p><ol><li>之前判断出的两条变线的交点就是角球点的大致方位;</li><li>在该交点旁边寻找最近的白点来当做角球点即可, 经过检验准确度基本可以得到保证.</li></ol></li></ul><p>实际算法中, 在上述判断标准的基础上都进行了一些 遍历相邻节点/取最优 操作, 以对结果做一定修正.</p><h5 id="4-2-2-匹配整体球场"><a href="#4-2-2-匹配整体球场" class="headerlink" title="4.2.2 匹配整体球场"></a>4.2.2 匹配整体球场</h5><p>在完成4.2.1操作后, 如果机器人视野中包括角球区, 那么已经可以确定角球点的位置, 接下来需要用已知标准的球场来拟合即可, 思路如下:</p><ol><li>用一根直线绕角球点旋转, 取经过白点最多角度, 如果经过的白点数量大于某一阙值, 进行2;</li><li>在1基础上, 用垂直于该边线的另一条直线来拟合白点, 如果经过白点数量大于一个阙值, 进行3;</li><li>在2基础上, 用经过白点数量来确定大禁区线位置, 同时也确定了1和2中确定直线哪条是底线, 哪条是边线.</li></ol><p>为了防止角球点位置不对导致错误匹配结果, 选取4.2.1中所得角球点周围若干点(实验中选16个)同时进行上述1/2操作, 如果1和2都成立, 则记录该角度, 到最后取平均角度作为最终边线/底线的角度. 通过检验, 可以得到较好效果, 随着机器人行走也可以较为及时地确定当前球场.</p><p><img src="http://i.imgur.com/p468GjV.png" alt=""></p><p>需要注意的是, 在某些特定角度, 和底线平行的大禁区线同样会被认定为底线, 因此4.2.1有可能会返回多个角球点, 这里可以按照角球点的图片坐标来区分, 因为机器人视野下的底线一定比禁区线更远, 因此选取图片坐标系中更靠上方的交点即可.</p><p>实际算法中, 在上述基础上, 加入了一些对特殊情况的判断. 参见代码.</p><h3 id="5-检测机器人坐标及朝向"><a href="#5-检测机器人坐标及朝向" class="headerlink" title="5. 检测机器人坐标及朝向"></a>5. 检测机器人坐标及朝向</h3><p>在完成4操作后, 已经得到了匹配后的球场结果. 接下来就需要根据机器人看到的机器人坐标系比来得到机器人在世界坐标系(XY)下的坐标.</p><p>因为已经确定了球场的两条边线的直线方程, 又已知机器人位于(423, 255)点, 因此只需要判断该角球点是在左还是在右即可, 这里先得到机器人和底线中点所连直线的方程, 再将角球点坐标代入, 判断正负即可知道左右.</p><p>在获知左右后, 即可知道机器人的世界坐标(X, Y), 判断底线和水平线夹角即可知道机器人的朝向.</p><p><img src="http://i.imgur.com/OgWrR4Q.png" alt=""></p><p>具体参见代码相应部分.</p><h3 id="6-检测足球世界坐标"><a href="#6-检测足球世界坐标" class="headerlink" title="6. 检测足球世界坐标"></a>6. 检测足球世界坐标</h3><p>在之前同学的视觉检测部分, 可以获取到球的机器人坐标, 在已知机器人的世界坐标的前提下, 可以求出足球的世界坐标, 需要注意的是在不同朝向范围内计算公式有一定区别, 虽然只是高中数学但还是需要认真推导, 实验中为了这个调了挺长时间Orz</p><p>具体参见代码相应部分.</p><h3 id="7-配置"><a href="#7-配置" class="headerlink" title="7. 配置"></a>7. 配置</h3><p>在qt下导入运行即可.<br>加入配置如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">CONFIG += c++11</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DEFINES += TEST_LIBRARY</span><br><span class="line"></span><br><span class="line">SOURCES += test.cpp \</span><br><span class="line">    matchpos.cpp</span><br><span class="line"></span><br><span class="line">HEADERS += test.h\</span><br><span class="line">        test_global.h \</span><br><span class="line">    matchpos.h</span><br><span class="line"></span><br><span class="line">INCLUDEPATH += /usr/local/include \</span><br><span class="line">                /usr/local/include/opencv \</span><br><span class="line">                /usr/local/include/opencv2</span><br><span class="line"></span><br><span class="line">LIBS += /usr/local/lib/libopencv_highgui.so \</span><br><span class="line">        /usr/local/lib/libopencv_core.so    \</span><br><span class="line">        /usr/local/lib/libopencv_imgproc.so \</span><br><span class="line">        /usr/local/lib/libopencv_photo.so</span><br></pre></td></tr></table></figure></p><h3 id="8-总结"><a href="#8-总结" class="headerlink" title="8. 总结"></a>8. 总结</h3><p>本部分实现原理比较简单, 主要工作都在调试改动上, 因为平面图像的误差导致用了很多奇怪的方法来匹配球场, 拟合坐标.</p><p>总结来看, 在刚开始还是对整体识别思路理得不够清楚, 有些地方可以用更好更简洁的方法来处理; 此外在各种角度计算统一上也出了很多bug, 也属于一开始没有统一好的锅..</p><p>最后郑重感谢老师和助教在小学期里的辛勤指导, 在很多地方给予了我们很关键的帮助.</p>]]></content>
    
    <summary type="html">
    
      小学期足球机器人项目, 负责球场检测+坐标计算部分..
    
    </summary>
    
      <category term="课程" scheme="https://dpatrickx.github.io/blog/categories/%E8%AF%BE%E7%A8%8B/"/>
    
    
  </entry>
  
  <entry>
    <title>四子棋ai</title>
    <link href="https://dpatrickx.github.io/blog/2016/02/29/four-chess/"/>
    <id>https://dpatrickx.github.io/blog/2016/02/29/four-chess/</id>
    <published>2016-02-29T03:15:00.000Z</published>
    <updated>2019-12-18T21:06:55.242Z</updated>
    
    <content type="html"><![CDATA[<h3 id="实验描述"><a href="#实验描述" class="headerlink" title="实验描述"></a>实验描述</h3><p>本实验对要求实现一个变种四子棋的 AI, 实验中对四子棋规则做了一定的扩展, 即随机 确定棋盘大小以及在棋盘上生成不可落子点. 要求在所给的实验框架下完成四子棋游戏的人 工智能决策部分并进行相应封装, 对于每次传 入的棋盘状态后返回一个落子点.</p><h2 id="实验分析"><a href="#实验分析" class="headerlink" title="实验分析"></a>实验分析</h2><p>在实验中我选择了蒙特卡洛算法, 评测结果较好, 以下简单就本实验算法选 择进行一定分析.  实验指导中推荐使用 alpha-beta 剪枝算法,  但使用 alpha-beta 剪枝算法的 难点是很难设计出较好的估价函数. 由于棋盘大小不定并且有不可落子点, 要找 到能够很合理地反应当前局面的估价函数并不容易, 则算法瓶颈落在了设计部分 上,  体现不出机器的优势,  要实现较好的改进也并不容易.  而蒙特卡洛算法则不存在这样的瓶颈问题,  蒙特卡洛算法的基本思路是对每 个点进行随机模拟落子直至比赛结束,  选胜率最高的点作为最终返回的落子点.  在模拟点数量较多时, 算法会逐渐收敛到当前最优解. 相比 alpha-beta 剪枝算 法, 蒙特卡洛算法可以看作用机器的优势来和人对弈,  在算法设计部分只需要做 到均衡算法过程中的模拟方向, 使每个点都能有一定量的模拟, 从而使结果更可 靠. 从以上分析不难看出,  蒙特卡洛算法成功与否主要取决于能否在给定时间内 进行较多次数的迭代.  在具体实现中,  为了保证迭代的次数和收敛效率, 可以以空间来换时间,  建 立一颗搜索树来记录每一个模拟局面下的胜率等信息,  在 5s 的时间限制内, 可 以生成 200W 个节点,  与 100.dll 对战时, 胜率也可以保持在 60%的水平.  需要指出的是,  蒙特卡洛算法在出解速度上远逊于 alpha-beta 剪枝. 同时, 如 果 alpha-beta 剪枝算法可以设计出一个很好的估价函数, 效果也可以好于蒙特 卡洛算法.</p><h2 id="算法流程"><a href="#算法流程" class="headerlink" title="算法流程"></a>算法流程</h2><ol><li><p>初始化棋局,  用 0 作为父节点, 即整棵树的根节点,  代表当前棋局状态;</p></li><li><p>如果满足终止条件(经过时间达到一定时间), 跳至 6;</p></li><li><p>判断父节点是否为叶子节点： 如果父节点为叶子节点,  那么对父节点进行扩展,  对扩展出的每一个 子节点都进行模拟对局,  并向上更新祖先几点的 totRound 和 winRound 信息; 如果父节点不是叶子节点,  不进行操作;</p></li><li><p>在父节点的子节点中选取 UCB 值最大的节点;</p></li><li><p>判断此节点对应的棋局状态是否已分出胜负:</p><ul><li><p>如果已经分出胜负,  再次向上更新 winRound 和 totRound 信息,  将父 节点置为 0, 跳至 2;</p></li><li><p>如果未分出胜负,  将选出的节点作为父节点,  跳至 2;</p></li></ul></li><li><p>从根节点的子节点中选取胜率最大点, 将该点记录坐标作为最终返回点.</p></li></ol><h2 id="实现细节"><a href="#实现细节" class="headerlink" title="实现细节"></a>实现细节</h2><ol><li><p><strong>MCNode 类：</strong><br>记录每一个节点的信息(即每新走一个棋子对应的一个棋盘状态)<br>x y 为最新加入棋子坐标<br>winRound 和 totRound 记录这个状态下 user 的胜场数和总场数, 需要注意的是父节点<br>和子节点的 user 不一样, 更新胜场数的时候也需要隔层更新</p> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MCNode</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> x,y;</span><br><span class="line">    <span class="keyword">int</span> lChild,rChild,father;</span><br><span class="line">    <span class="keyword">bool</span> user,isLeaf; <span class="comment">// user: false--&gt;oppoent, true--&gt;me</span></span><br><span class="line">    <span class="keyword">int</span> winRound, totRound;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p><strong>全局变量：</strong><br>为了加快迭代速度,  用全局数组来创建树结构,  并在全局创建 tempTop1/2和tempBoard1/2 来记录临时的棋局状态以方便对树中节点进行扩展和模拟</p> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MCNode nodes[NODENUM];</span><br><span class="line"><span class="keyword">int</span> rank;</span><br><span class="line"><span class="keyword">int</span> sel;</span><br><span class="line"><span class="keyword">int</span> fNode = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span>* tempTop1;</span><br><span class="line"><span class="keyword">int</span>* tempTop2; <span class="comment">// used for modify function</span></span><br><span class="line"><span class="keyword">int</span>** tempBoard1;</span><br><span class="line"><span class="keyword">int</span>** tempBoard2; <span class="comment">// used for modify function</span></span><br><span class="line"><span class="keyword">int</span> nn = <span class="number">0</span>,mm = <span class="number">0</span>,banX = <span class="number">-1</span>,banY = <span class="number">-1</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>扩展及模拟节点</strong><br>在父节点为叶子节点时,  需要对父节点进行扩展,  这里需要对不可落子点进行判断, 使<br>得每个节点中的 x y 值都是可落子的.<br>模拟过程中即在当前状态下随机选取位置来落子,  并且判断是否分出了胜负, 在得到胜<br>负结果后向上进行更新</p></li><li><strong>计算 UCB 值</strong><br>每个节点 UCB 值的设计是蒙特卡洛算法中比较关键的一点,  分为两部分,  前部分为计算<br>该节点上的胜率,  胜率越高被选择的几率越大,  而后一部分则是为了平衡模拟方向,  使<br>得之前模拟次数越少的点越有机会被选中 <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nodes[sel].winRound/(nodes[sel].totRound+epsilon) +</span><br><span class="line">C*sqrt(log(nodes[fNode].totRound+1)/(nodes[sel].totRound+epsilon)))</span><br></pre></td></tr></table></figure></li></ol><ul><li>实现语言: c++</li><li>编译工具： g++</li><li>运行环境： Windows</li><li>编译方式：同目录下运行 makefile</li></ul><h2 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h2><p><strong> 与 62-100.dll 对战结果(胜场数/总场数)：</strong></p><table><thead><tr><th style="text-align:center">ai序号</th><th style="text-align:center">胜场/总场数</th></tr></thead><tbody><tr><td style="text-align:center">100.dll</td><td style="text-align:center">6/10</td></tr><tr><td style="text-align:center">98.dll</td><td style="text-align:center">7/10</td></tr><tr><td style="text-align:center">96.dll</td><td style="text-align:center">8/10</td></tr><tr><td style="text-align:center">94.dll</td><td style="text-align:center">8/10</td></tr><tr><td style="text-align:center">92.dll</td><td style="text-align:center">8/10</td></tr><tr><td style="text-align:center">90.dll</td><td style="text-align:center">8/10</td></tr><tr><td style="text-align:center">88.dll</td><td style="text-align:center">10/10</td></tr><tr><td style="text-align:center">86.dll</td><td style="text-align:center">9/10</td></tr><tr><td style="text-align:center">84.dll</td><td style="text-align:center">10/10</td></tr><tr><td style="text-align:center">82.dll</td><td style="text-align:center">10/10</td></tr></tbody></table><p><strong> 与 100.dll 对战 100 场(50rounds)结果(AI 为 A 方)：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Stat:</span><br><span class="line">ratio of A wins : 0.57</span><br><span class="line">ratio of B wins : 0.43</span><br><span class="line">ratio of Tie : 0</span><br><span class="line">ratio of (A wins + tie) : 0.57</span><br><span class="line">ratio of (B wins + tie) : 0.43</span><br></pre></td></tr></table></figure><h2 id="结果分析"><a href="#结果分析" class="headerlink" title="结果分析"></a>结果分析</h2><p>在测试过程中我打印了所选节点的胜率,  结果基本符合之前的收敛分析,  在 可以获胜的棋局中胜率逐渐增大,  而且当胜率增大到 65%时获胜几率十分大;同 样在胜率小于 40%时失败的几率也十分大.  在测试时如果将截止时间进一步增大 并且减少对超时的判断次数, 程序迭代的点个数可以接近 300W, 胜率也进一步 增大, 但这种情况下存在超时的风险.  综合来看蒙特卡洛算法可以较好的完成四子棋博弈的求解.</p>]]></content>
    
    <summary type="html">
    
      本实验对要求实现一个变种四子棋的 AI, 实验中对四子棋规则做了一定的扩展, 即随机 确定棋盘大小以及在棋盘上生成不可落子点.
    
    </summary>
    
      <category term="课程" scheme="https://dpatrickx.github.io/blog/categories/%E8%AF%BE%E7%A8%8B/"/>
    
    
      <category term="algorithm" scheme="https://dpatrickx.github.io/blog/tags/algorithm/"/>
    
  </entry>
  
  <entry>
    <title>简易DBMS的c++实现报告</title>
    <link href="https://dpatrickx.github.io/blog/2015/12/20/database/"/>
    <id>https://dpatrickx.github.io/blog/2015/12/20/database/</id>
    <published>2015-12-20T13:20:00.000Z</published>
    <updated>2019-12-18T21:07:03.530Z</updated>
    
    <content type="html"><![CDATA[<h3 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h3><p>实验在IO方面主要调用的是提供好的BufPageManager和FileManager, 并对其进行了一系列的封装操作. 其中, BufPageManager中的文件即项目中所提的表, 项目中数据库的实现即所有表存放的一个文件夹. 由于BufPageManager每次读写一页大小为8kb, 因此将8kb作为一个页的大小.</p><p>每创建一个表时, 系统将初始化32个页作为该表的初始容量. 每个表的第零页存储该表共有的页数n（4B）, 以及大小为n的bitmap存储相应的页是否有空槽. 每个页大小为8KB. 由于每个表在创建的时候, 每条项目的最大长度是固定的, 所以以该最大长度作为每一个项目的长度, 并根据该长度确定每一页中最多存入多少条. 这里需要说明每一页存储的格式. 在每一页的尾端系统会维护一个长度为最多存入条数的bitmap, 用来记录每个槽位是否有条目占用. 同时, 在每个存入的条目末尾, 项目会维护一个长度为每个条目中属性个数的bitmap, 用来记录该条目对应的属性是否为NULL. 具体的页结构见如下示意图：<br><img src="http://i.imgur.com/iLVqERU.png" alt="1"></p><h3 id="系统功能"><a href="#系统功能" class="headerlink" title="系统功能"></a>系统功能</h3><p>支持MySQL的一些系列基本操作：Create语句（创建数据库DATABASE, 创建表TABLE）, Drop语句, Select语句, Delete语句, Insert语句, Update语句, DESC语句. 同时能够支持其他功能有：多表连接, 聚集查询, 聚集查询, 分组聚集查询, 模糊匹配, 外键约束, 运算符和运算表达式等.</p><h3 id="主要模块设计原理"><a href="#主要模块设计原理" class="headerlink" title="主要模块设计原理"></a>主要模块设计原理</h3><h4 id="1-记录管理模块"><a href="#1-记录管理模块" class="headerlink" title="1. 记录管理模块"></a>1. 记录管理模块</h4><p>该模块主要负责底层有关table的相关操作, 实现一些类和方法对存储记录的文件进行管理. 实现这个模块的主要内容在系统所定义的Table类中, 这个类中一些需要维护的属性如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Table</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> _fileID;</span><br><span class="line">    <span class="keyword">int</span> length;     <span class="comment">// length of item / byte</span></span><br><span class="line">    <span class="keyword">int</span> slotNum;    <span class="comment">// number of data slot</span></span><br><span class="line">    <span class="keyword">int</span> bitSize;    <span class="comment">// number of bitmap bits in the end of page</span></span><br><span class="line">    <span class="keyword">int</span> typeNum;</span><br><span class="line">    uint pageNum;   <span class="comment">// first 4 bytes of first page of the file</span></span><br><span class="line">    <span class="keyword">int</span> nullPos;     <span class="comment">// offset of null bitmap in each item</span></span><br><span class="line">    <span class="keyword">int</span> freeNumPos;  <span class="comment">// freeMapPos - 4</span></span><br><span class="line">    <span class="keyword">int</span> freeMapPos;  <span class="comment">// offset of free bitmap in each page</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> tbName;</span><br><span class="line">    <span class="built_in">string</span> path;    <span class="comment">// path/tbName.txt</span></span><br><span class="line">    <span class="built_in">string</span> priKey;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">int</span>&gt; offset;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; sequence;</span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; &gt; check;</span><br><span class="line">    Attr example;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><blockquote><p>说明：length表示每个条目的最大长度, slotNum表示每个页可供使用的槽的数目, bitSize指的是每页最后的Bitmap大小, typeNum指的是每个条目中的属性的数量, pageNum指的是一个Table中所拥有的页数, nullPos指的是每个条目最后bitmap相对于该条目起始位置的偏移量, offset保存了每个条目中的每个属性相对于该条目起始位置的偏移量, sequence保存了各个属性的名称, check保存了响应属性名称的域完整性约束, example是一个样例条目：保存了每个条目的最大长度, 条目中每个属性的类型以及长度</p></blockquote><p>在每个表中系统还维护了一个hashMap, 用来保存主键的取值, 如果待插入条目中的主键值已经存在于hashMap中, 则报错.<br>    <strong>- 插入操作：</strong><br>    主要的实现的功能为维护域完整性, 主键重复报错, 以及插入条目中存在null时的判断. 在插入一个新条目之前, 程序先查看每个表的第零页, 找到存在空槽的页, 然后查看该页尾端的bitmap, 确定一个空槽的位置, 也就是插入的位置. 然后进行check以及主键的检查工作. 接着程序会根据example对每个条目的描述来确定插入的信息, 并根据offset中记录的每个属性的偏移量来进行插入操作.<br>    <strong>- 删除操作：</strong><br>    当一个条目待删除时, 系统不会将存储有该条目内容的槽位清空, 而是会把对应页尾端bitmap的值置为“空闲”, 这样在查询和插入操作进行的时候, 访问页尾端的bitmap即可知道哪些条目存在, 哪些是空槽, 就不必每条都进行访问, 从而提高了效率.<br>    <strong>- 更新操作：</strong><br>    当更新一个条目的时候, 系统首先会调用一个名为conform的函数来对更新的条件与每个条目进行匹配, 如果一个条目符合条件, 则在相对位置上重写条目即可. 由于example样例条目的存在, 系统会根据条目中属性的类型以及长度先提取出待更新的条目, 然后对需要更新的属性进行更新, 在重新写入相应的槽位即可.<br>    <strong>- 查询操作</strong><br>    与更新操作类似, 系统会调用conform函数来匹配条件与每个条目, 并输出相应查找的属性. </p><h4 id="2-系统管理模块"><a href="#2-系统管理模块" class="headerlink" title="2. 系统管理模块"></a>2. 系统管理模块</h4><p>首先介绍sql语句的解析过程, 如下图所示<br><img src="http://i.imgur.com/ffQYyyX.jpg" alt="main"><br>其中</p><ul><li>YACC是利用yacc工具进行的语法解析类；</li><li>DBManager类记录并管理所有的database, 利用单例模式构建；</li><li>DataBase类是一个database的实例, 记录有database的表单等信息；</li><li>Table类管理一个表单, 可以对一个table进行item的操作(添加/删除/更改等).</li></ul><p>在数据库存储中, 每个database对应一个文件夹, 而每个table对应一个文本文件. 因此在系统管理模块需要对本地数据进行相应更改, 结合语句简要说明如下：</p><ul><li>创建数据库：DBManager类中的database队列增加相应记录, 并在本地创建文件夹；</li><li>删除数据库：DBManager类中移除相应database, 并将本地文件夹移除；</li><li>切换数据库：在DBManager中记录当前数据库, 更改该属性即可；</li><li>创建表： 在相应DataBase类中增加相应table记录, 在该文件夹下增加相应文本文件；</li><li>删除表： 在相应DataBase类中移除相应table记录, 在该文件夹下删除相应文本文件.</li></ul><h4 id="3-查询解析模块"><a href="#3-查询解析模块" class="headerlink" title="3. 查询解析模块"></a>3. 查询解析模块</h4><p>语句解析部分和<strong><em>系统管理模块</em></strong>部分相同.<br>在YACC解析到相应语句后, 会借助DBManager来调用相应database中的table类来进行相应操作.<br><strong>以下部分以<code>insert</code>语句为例说明整个过程：</strong><br><strong>1. yacc语法解析</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">insertsql:</span><br><span class="line">    INSERT INTO IDENTIFIER &apos;(&apos; tableitems &apos;)&apos; VALUES valuesql &#123;</span><br><span class="line">        $$.init($3, $5, $8);</span><br><span class="line">        $$.display();</span><br><span class="line">        $$.work();</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure></p><p>利用yacc解析出insertsql后直接调用相应类的work函数.<br><strong>2. DBManager获取DataBase</strong><br>work函数直接调用DBManager类的相应函数<code>tbWork</code>, 而在该函数中会先获取相应DataBase类, 然后调用该DataBase类的函数<code>insertTB</code>;<br><strong>3. DataBase获取Table</strong><br>在DataBase中会先获取对应table类, 然后调用table的函数<code>select</code>；<br><strong>4. Table调用insert函数</strong><br>相应table执行insert函数, 函数原理见 <strong><em>记录管理模块</em></strong></p><h4 id="4-附加模块："><a href="#4-附加模块：" class="headerlink" title="4. 附加模块："></a>4. 附加模块：</h4><ul><li><p>域完整性约束, 建表时的check关键字<br>由于系统在表中有关于域完整性约束的map, 所以在新加入一个条目的时候只需查找对应map条目中是否包含添加的项, 如果不包含则报错；</p></li><li><p>外键约束<br>外键约束由于系统对于每个表都维护了一个hashMap, 所以只需查找相应表中的hashMap即可判断是否违反外键约束；</p></li><li><p>模糊匹配<br>模糊匹配系统使用了c++11, 因为c++11中能够采用正则表达式, 系统对于每个输入的模糊匹配串都做了如下处理：将%替换为.*, 将_替换为., 这样就可以用待匹配串与每个条目相应属性的值做正则匹配. </p></li><li><p>三个表以上的连接<br>由于系统未能有效实现索引功能, 所以多表连接问题系统采用的是最原始的暴力搜索方法, 不过在搜索过程中系统还是做了一些优化, 使得每搜索一个正确条目所用的时间并不显得十分长（但是计算复杂度可知相应的时间消耗依旧是n^2级别的）</p></li><li><p>聚集查询<br>聚集查询系统默认待查询的属性的类型为int, 所以只需将表遍搜, 然后获取相应查询操作的结果即可. </p></li><li><p>分组聚集查询<br>分组聚集查询是在聚集查询的基础上用一个临时的map将不同类别的值分别存储, 从而达到分组的目的. </p></li></ul><h4 id="5-数据库信息存储"><a href="#5-数据库信息存储" class="headerlink" title="5. 数据库信息存储"></a>5. 数据库信息存储</h4><p>以上所描述各用于维持数据库的类在程序结束时会依次写入本地文件中, 在下次程序运行时会先读入该部分数据, 完成各类的恢复工作. </p><h3 id="运行方式"><a href="#运行方式" class="headerlink" title="运行方式"></a>运行方式</h3><ul><li>主程序及makefile文件均在在/yacc/目录下, 利用该makefile即可进行编译, 生成主程序main；</li><li>需要预先安装库：flex、bison、g++；</li><li>主程序运行方式：直接运行主程序, 之后需要输入一个参数(0或1)：<ul><li>1表示不读入本地文件, 重新构建一个数据库</li><li>0表示读入本地文件, 即恢复到上次程序结束时的状态</li><li>在首次运行时需要输入1, 之后使用0参数即可</li></ul></li></ul><h3 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h3><p>实验结果表明, 此数据库文件系统可以很好地完成系统管理模块以及查询解析模块的相应工作, 并且能够很好地执行附加模块中域完整性约束、模糊匹配、聚集查询、分组聚集查询, 由于系统没有实现索引模块, 所以在外键约束和三个表以上的连接的功能上实现的效率不是很高, 因为采用的是暴力搜索的方法. </p><h4 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h4><p><strong>1. 系统管理模块</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> tempDB;</span><br><span class="line"><span class="keyword">USE</span> tempDB;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> publisher(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"><span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">state <span class="built_in">varchar</span>(<span class="number">25</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLES</span>;</span><br><span class="line">DESC publisher;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> publisher;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> tempDB;</span><br></pre></td></tr></table></figure></p><p><strong>结果</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SQL: <span class="keyword">show</span> <span class="keyword">table</span></span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line"><span class="keyword">tables</span> <span class="keyword">in</span> tempDB</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">publisher</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span>:  <span class="keyword">desc</span> <span class="keyword">table</span> publisher</span><br><span class="line">+<span class="comment">-------------+-------------+------+-----+</span></span><br><span class="line">| <span class="keyword">Field</span>       | <span class="keyword">Type</span>        | <span class="literal">Null</span> | <span class="keyword">Key</span> |</span><br><span class="line">+<span class="comment">-------------+-------------+------+-----+</span></span><br><span class="line">| <span class="keyword">id</span> | <span class="built_in">INT</span>(<span class="number">10</span>) | <span class="keyword">NO</span>  | PRI |</span><br><span class="line">| <span class="keyword">name</span> | <span class="built_in">VARCHAR</span>(<span class="number">25</span>) | <span class="keyword">NO</span>  |     |</span><br><span class="line">| state | <span class="built_in">VARCHAR</span>(<span class="number">25</span>) | <span class="keyword">NO</span>  |     |</span><br><span class="line">+<span class="comment">-------------+-------------+------+-----+</span></span><br></pre></td></tr></table></figure></p><p><strong>2. 查询解析模块</strong></p><p><strong>SQL</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> publisher <span class="keyword">VALUES</span> (<span class="number">105001</span>, <span class="string">'American Technical Publisher'</span>, <span class="string">'GA'</span>);</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> publisher <span class="keyword">WHERE</span> <span class="keyword">id</span> = <span class="number">105001</span>;</span><br></pre></td></tr></table></figure></p><p><strong>结果</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id: 105001</span><br><span class="line">name: American Technical Publisher</span><br><span class="line">state: GA</span><br></pre></td></tr></table></figure></p><p><strong>SQL</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> customer <span class="keyword">VALUES</span> (<span class="number">300002</span>, <span class="string">'CHAD CABELLO'</span>, <span class="string">'F'</span>);</span><br></pre></td></tr></table></figure></p><p><strong>结果</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Primary Key Conflict!</span><br></pre></td></tr></table></figure></p><p><strong>SQL</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> orders <span class="keyword">VALUES</span> (<span class="number">304403</span>, <span class="number">200001</span>, <span class="string">'eight'</span>);</span><br></pre></td></tr></table></figure></p><p><strong>结果</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INPUT ERROR</span><br></pre></td></tr></table></figure></p><p><strong>SQL</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> quantity &lt; <span class="number">2</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> quantity &lt; <span class="number">2</span>;</span><br></pre></td></tr></table></figure></p><p><strong>结果</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">为空</span><br></pre></td></tr></table></figure></p><p><strong>SQL</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> book <span class="keyword">SET</span> title=<span class="string">'Nine Times Nine'</span> <span class="keyword">WHERE</span> <span class="keyword">authors</span>=<span class="string">'David Ray'</span>;</span><br><span class="line"><span class="keyword">SELECT</span> title <span class="keyword">FROM</span> book <span class="keyword">WHERE</span> <span class="keyword">authors</span>=<span class="string">'David Ray'</span>;</span><br></pre></td></tr></table></figure></p><p><strong>结果</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">title: Nine Times Nine</span><br></pre></td></tr></table></figure></p><p><strong>SQL</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> book <span class="keyword">SET</span> copies=<span class="string">'eight'</span> <span class="keyword">WHERE</span> title=<span class="string">'A Walk Through the Fire'</span>;</span><br></pre></td></tr></table></figure></p><p><strong>结果</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Update Input Error</span><br></pre></td></tr></table></figure></p><p><strong>SQL</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> publisher <span class="keyword">WHERE</span> state=<span class="string">'CA'</span>;</span><br></pre></td></tr></table></figure></p><p><strong>结果(选取部分)</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">id: 104992</span><br><span class="line">name: China Books &amp;amp; Periodicals</span><br><span class="line">state: CA</span><br><span class="line"><span class="comment">-------------------------</span></span><br><span class="line">id: 104993</span><br><span class="line">name: Dow Jones &amp;amp; Company, Inc.</span><br><span class="line">state: CA</span><br><span class="line"><span class="comment">-------------------------</span></span><br><span class="line">id: 104994</span><br><span class="line">name: Fox Chapel Publishing Company</span><br><span class="line">state: CA</span><br><span class="line"><span class="comment">-------------------------</span></span><br><span class="line">id: 104996</span><br><span class="line">name: W.h. Smith And Son Publishers</span><br><span class="line">state: CA</span><br><span class="line"><span class="comment">-------------------------</span></span><br><span class="line">id: 104997</span><br><span class="line">name: Transworld Publishers Limited</span><br><span class="line">state: CA</span><br></pre></td></tr></table></figure></p><p><strong>SQL</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> title <span class="keyword">FROM</span> book <span class="keyword">WHERE</span> <span class="keyword">authors</span> <span class="keyword">is</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure></p><p><strong>结果</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">title: Anyone Can Have a Happy</span><br></pre></td></tr></table></figure></p><p><strong>SQL</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> book.title, publisher.name, publisher.state <span class="keyword">FROM</span> book, publisher <span class="keyword">WHERE</span> book.publisher_id=publisher.id <span class="keyword">AND</span> publisher.state=<span class="string">'CA'</span>;</span><br></pre></td></tr></table></figure></p><p><strong>结果(选取部分)</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">*** publisher ***</span><br><span class="line">state: CA</span><br><span class="line">*** publisher ***</span><br><span class="line">name: Anglican Book Centre</span><br><span class="line">*** book ***</span><br><span class="line">title: Exortacao Aos Crocodilos</span><br><span class="line"><span class="comment">-------------------------</span></span><br><span class="line">*** publisher ***</span><br><span class="line">state: CA</span><br><span class="line">*** publisher ***</span><br><span class="line">name: Lyle Stuart Hardcover</span><br><span class="line">*** book ***</span><br><span class="line">title: The Rancher Takes a Wife</span><br><span class="line"><span class="comment">-------------------------</span></span><br><span class="line">*** publisher ***</span><br><span class="line">state: CA</span><br><span class="line">*** publisher ***</span><br><span class="line">name: Linstok Press, Incorporated</span><br><span class="line">*** book ***</span><br><span class="line">title: Flambards (Puffin Books)</span><br><span class="line"><span class="comment">-------------------------</span></span><br><span class="line">*** publisher ***</span><br><span class="line">state: CA</span><br><span class="line">*** publisher ***</span><br><span class="line">name: Bantam Doubleday Dell Pub</span><br><span class="line">*** book ***</span><br><span class="line">title: A Tall Man in a Low Land</span><br></pre></td></tr></table></figure></p><p><strong>3. 域完整性约束</strong><br><strong>SQL</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> customer <span class="keyword">VALUES</span> (<span class="number">307001</span>, <span class="string">'CHAD CABELLO'</span>, <span class="string">'Male'</span>);</span><br><span class="line"><span class="keyword">UPDATE</span> publisher <span class="keyword">SET</span> state=<span class="string">'HI'</span> <span class="keyword">WHERE</span> <span class="keyword">name</span>=<span class="string">'New Video Group Inc'</span>;</span><br></pre></td></tr></table></figure></p><p><strong>结果</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Check</span> <span class="keyword">error</span></span><br><span class="line"><span class="keyword">Check</span> <span class="keyword">error</span></span><br></pre></td></tr></table></figure></p><p><strong>4. 外键约束</strong><br><strong>SQL</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> book <span class="keyword">SET</span> publisher_id=<span class="string">'106001'</span> <span class="keyword">WHERE</span> title=<span class="string">'A Voice Through a Cloud'</span>;</span><br></pre></td></tr></table></figure></p><p><strong>结果</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Against publisher Key Restriction</span><br></pre></td></tr></table></figure></p><p><strong>5. 模糊匹配</strong><br><strong>SQL</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, gender <span class="keyword">FROM</span> customer <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'_USTY%'</span>;</span><br></pre></td></tr></table></figure></p><p><strong>结果</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">*** customer ***</span><br><span class="line">gender: F</span><br><span class="line">*** customer ***</span><br><span class="line">name: RUSTY PITTARD</span><br><span class="line"><span class="comment">-------------------------</span></span><br><span class="line">*** customer ***</span><br><span class="line">gender: F</span><br><span class="line">*** customer ***</span><br><span class="line">name: RUSTY FELT</span><br><span class="line"><span class="comment">-------------------------</span></span><br><span class="line">*** customer ***</span><br><span class="line">gender: M</span><br><span class="line">*** customer ***</span><br><span class="line">name: RUSTY SANNER</span><br><span class="line"><span class="comment">-------------------------</span></span><br><span class="line">*** customer ***</span><br><span class="line">gender: M</span><br><span class="line">*** customer ***</span><br><span class="line">name: DUSTY DEMELO</span><br><span class="line"><span class="comment">-------------------------</span></span><br><span class="line">*** customer ***</span><br><span class="line">gender: F</span><br><span class="line">*** customer ***</span><br><span class="line">name: RUSTY DACUS</span><br><span class="line"><span class="comment">-------------------------</span></span><br><span class="line">*** customer ***</span><br><span class="line">gender: F</span><br><span class="line">*** customer ***</span><br><span class="line">name: DUSTY LIRETTE</span><br><span class="line"><span class="comment">-------------------------</span></span><br><span class="line">*** customer ***</span><br><span class="line">gender: M</span><br><span class="line">*** customer ***</span><br><span class="line">name: DUSTY KUEHN</span><br></pre></td></tr></table></figure></p><p><strong>6. 三个表以上的连接</strong><br><strong>SQL</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> customer.name,book.title,orders.quantity <span class="keyword">FROM</span> customer,book,orders</span><br><span class="line"><span class="keyword">WHERE</span> orders.customer_id=customer.id <span class="keyword">AND</span> orders.book_id=book.id <span class="keyword">AND</span> orders.quantity &gt; <span class="number">8</span>;</span><br></pre></td></tr></table></figure></p><p><strong>因未加索引模块, 此部分运行时间过长, 不展示结果</strong></p><p><strong>7. 聚集查询</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(quantity) <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> customer_id=<span class="number">304403</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(quantity) <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> customer_id=<span class="number">304403</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(quantity) <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> customer_id=<span class="number">304403</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(quantity) <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> customer_id=<span class="number">304403</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> customer_id=<span class="number">304403</span>;</span><br></pre></td></tr></table></figure></p><p><strong>结果</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SQL:  <span class="keyword">select</span> <span class="keyword">sum</span>(quantity), <span class="keyword">from</span> orders</span><br><span class="line">+<span class="comment">------------------------------+</span></span><br><span class="line"><span class="keyword">SUM</span>(quantity): <span class="number">23</span></span><br><span class="line"><span class="comment">-------------------</span></span><br><span class="line"><span class="keyword">SQL</span>:  <span class="keyword">select</span> <span class="keyword">avg</span>(quantity), <span class="keyword">from</span> orders</span><br><span class="line">+<span class="comment">------------------------------+</span></span><br><span class="line"><span class="keyword">AVG</span>(quantity): <span class="number">4</span></span><br><span class="line"><span class="comment">-------------------</span></span><br><span class="line"><span class="keyword">SQL</span>:  <span class="keyword">select</span> <span class="keyword">max</span>(quantity), <span class="keyword">from</span> orders</span><br><span class="line">+<span class="comment">------------------------------+</span></span><br><span class="line"><span class="keyword">MAX</span>(quantity): <span class="number">9</span></span><br><span class="line"><span class="comment">-------------------</span></span><br><span class="line"><span class="keyword">SQL</span>:  <span class="keyword">select</span> <span class="keyword">min</span>(quantity), <span class="keyword">from</span> orders</span><br><span class="line">+<span class="comment">------------------------------+</span></span><br><span class="line"><span class="keyword">MIN</span>(quantity): <span class="number">2</span></span><br><span class="line"><span class="comment">-------------------</span></span><br><span class="line"><span class="keyword">SQL</span>:  <span class="keyword">select</span> <span class="keyword">count</span>(*), <span class="keyword">from</span> orders</span><br><span class="line">+<span class="comment">------------------------------+</span></span><br><span class="line"><span class="keyword">COUNT</span>(*): <span class="number">5</span></span><br></pre></td></tr></table></figure></p><p><strong>8. 分组聚焦查询</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(quantity) <span class="keyword">FROM</span> orders <span class="keyword">GROUP</span> <span class="keyword">BY</span> customer_id;</span><br></pre></td></tr></table></figure></p><p><strong>结果(展示部分)</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">306981: SUM(quantity): 11</span><br><span class="line">306982: SUM(quantity): 7</span><br><span class="line">306983: SUM(quantity): 15</span><br><span class="line">306984: SUM(quantity): 17</span><br><span class="line">306985: SUM(quantity): 27</span><br><span class="line">306986: SUM(quantity): 31</span><br><span class="line">306987: SUM(quantity): 3</span><br><span class="line">306988: SUM(quantity): 20</span><br><span class="line">306989: SUM(quantity): 30</span><br><span class="line">306990: SUM(quantity): 17</span><br><span class="line">306991: SUM(quantity): 39</span><br><span class="line">306992: SUM(quantity): 24</span><br><span class="line">306993: SUM(quantity): 8</span><br><span class="line">306994: SUM(quantity): 39</span><br><span class="line">306995: SUM(quantity): 6</span><br><span class="line">306996: SUM(quantity): 32</span><br><span class="line">306997: SUM(quantity): 13</span><br><span class="line">306998: SUM(quantity): 28</span><br><span class="line">306999: SUM(quantity): 11</span><br><span class="line">307000: SUM(quantity): 39</span><br></pre></td></tr></table></figure></p><h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><p>[1]. 数据库系统设计与原理 第二版 冯建华 周立柱 郝晓龙 编著</p><p>[2]. 数据库系统概念 Silberschatz Korth Sudarshan 著 杨冬青等 译</p><h3 id="项目github链接："><a href="#项目github链接：" class="headerlink" title="项目github链接："></a>项目github链接：</h3><p><a href="https://github.com/dpatrickx/dbclass" target="_blank" rel="noopener">dbclass project</a></p>]]></content>
    
    <summary type="html">
    
      实验在IO方面主要调用的是提供好的BufPageManager和FileManager, 并对其进行了一系列的封装操作.
    
    </summary>
    
      <category term="课程" scheme="https://dpatrickx.github.io/blog/categories/%E8%AF%BE%E7%A8%8B/"/>
    
    
  </entry>
  
</feed>
